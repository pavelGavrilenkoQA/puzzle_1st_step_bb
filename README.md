# Пробный проект автотестов JBJ
Проект автотестов. На данный момент запускает простые тап тесты в приложении пазлов.

## Требования 
|        | v     |
|--------|-------|
| Python | 3.x   |
|JBJ app | 1.0.129+ Debug|

Для автоматического прохождения тутора необходима дебаг версия. Шаги построенны на
ожидании решеного пазла + тап кнопки "win"


## Запуск
-- При первом скачивании проекта необходимо установить зависимости 
при активированном ВО

```sh
pip install -r requirements.txt
```

Устройство Андроид подтягивается автоматически. 
Для запуска на iOS при установленом Truner и запущенной проксей на 8100 изменить ключ девайса на "ios:///http://127.0.0.1:8100"
(старт возможен только на яблочной ОСи)
При пуске на iOS закомененить шаг с очисткой кэша (не поддерживается при ране на яблочных девайсах - автоветвление в процессе)


-- приложение закрыто, девайс разблокирован 

-- Запустить main\main.py
```sh
py main.py
```

## Отчеты
 
--Тестовые функции запускаются через простой логгер. 
Список упавших и прошедших тестов(функций) формируется в txt файлах в корне проекта
по окончанию

-- По каждому feature пакету выводиться html отчет с визуализаций 
мест тапов и ассертов тестов с описанием в папку html_report в корень проекта -
названия отчетов соответствуют названиям фича-директорий

## Структура и доп инфа

-- Шаги swipe не могут подтягивать аргументы графических якорей из директорий
paje_jobject. При насписании шагов со свайпом якорь и аргументы нужно указать внутри шага. Пример:

```sh
def swipe_shop():
    swipe(Template(fr"{PAGE_ROOT_TAISIA}swipe_shop.png",
                   record_pos=(-0.103, 0.128),
                   resolution=(1080, 2400)),
          vector=[-0.0145, -0.1634])
    sleep(2.0)
```


-- Тесты последовательны и созависимы в каждой фиче. 
Отдельные итерации запуска\закрытия приложения реализованы
только на уровне запуска фичи для экономии времени прохождения, 
но эта экономия влечет выскоий уровень атомарности пакетов фичей. 
На данном этапе падения теста в середине фичи с 90% вероятностью 
повлечет падение следующих за ним тестов фича пакета. 

-- Директории фичей собраны по локальному либо функциональному соответстию: 
разделам приложения и смежным с ними фунционалу


## Приоритет работ по проекту автоматики JBJ

1. Написание стартовой фичи для сброса app_data и прохождения туториала (done)
2. Доработка для запуска на разных локальных устройствах из одного проекта (done)
3. Автоматизация подтягивания подключённых устройств (Android - done)
4. Доработки для локального запуска через Appium Server (done-skip) - найден способ пуска в скрипте в обход апиума
5. Написание инфраструктуры для установочного тестирования Android на BitBar текущим пулом тестов средствами Appium (done)
6. Реализация возможности подключения iOS (для локального запуска) (done)
7. Реализация возможности подключения iOS (в инфре BitBar)
8. Рефактор структуры фичей под стандарт UnitTest
9. Расширение сьюта тестов 
10. Рефактор проекта под нужды вертикального расширения (переход на paje_object + step_def)
11. Изменение кода тестов для запуска из пэдж обежктов + стедефы 
12. Продумать и реализовать структуру ветвления для ключа девайсов и использования команды очистки кэша, прикрутить систему переменной среды для определения ОСи и переадчи в код

